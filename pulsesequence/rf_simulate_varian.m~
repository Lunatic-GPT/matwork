function rf_simulate_varian(fname,pw,B1max,freq,M0)
% rf_simulate_varian(fname,pw,B1max,f_range,M0)
% fname: name of the rf pattern
% pw : total pulse width in seconds.
% B1max: peak RF field strength in Hz. (Larmor frequency of proton at that field) 
% freq: frequencies to simulate. in Hz.
% M0: a 1*3 matrix specifying the initial magnetization.
T1 = 1.01;
T2 = 0.2;

B1max = 
a=textread(fname,'','commentstyle','shell');

a(:,1)=a(:,1)*pi/180;
a(:,2) = a(:,2)/max(a(:,2))*B1max;
rf = a(:,2).*(cos(a(:,1))+1i*sin(a(:,1)));


t = a(:,3);
t = t/sum(t)*pw;

[mx,my,mz]=bloch(rf,0,t,T1,T2,freq,0,0,M0(1),M0(2),M0(3));

figure;plot(freq,[mx(:) my(:) mz(:)]);
legend('mx','my','mz');



